```
需要掌握:
1.进程/线程协程的定义
2.进程/线程/协程有什么关系,有什么区别
3.进程和线程/协程比有什么优点,有什么缺点
4.线程和进程相比有什么优点,缺点
5.协程和线程/进程有什么优点,缺点
```



### 区别

每个程序里最少有一个进程
一个进程里最少有一个线程
不同进程间的线程资源不共享,同一进程间的线程可以共享

### 一、进程 （Process）

进程是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。在早期面向进程设计的计算机结构中，进程是程序的基本执行实体；在当代面向线程设计的计算机结构中，进程是线程的容器。程序是指令、数据及其组织形式的描述，进程是程序的实体。

#### 组成:

进程是一个实体。每一个进程都有它自己的地址空间，一般情况下，包括文本区域（text region）、数据区域（data region）和堆栈（stack region）。文本区域存储处理器执行的代码；数据区域存储变量和进程执行期间使用的动态分配的内存；堆栈区域存储着活动过程调用的指令和本地变量。

#### 特征 

动态性：进程的实质是程序在多道程序系统中的一次执行过程，进程是动态产生，动态消亡的。 
并发性：任何进程都可以同其他进程一起并发执行 
独立性：进程是一个能独立运行的基本单位，同时也是系统分配资源和调度的独立单位； 
异步性：由于进程间的相互制约，使进程具有执行的间断性，即进程按各自独立的、不可预知的速度向前推进 
结构特征：进程由程序、数据和进程控制块三部分组成。 
多个不同的进程可以包含相同的程序：一个程序在不同的数据集里就构成不同的进程，能得到不同的结果；但是执行过程中，程序不能发生改变。

#### 状态 

运行态/就绪态/阻塞态

 ![这里写图片描述](https://img-blog.csdn.net/20180301143430302?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3V5YW4wMzE5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70) 

### 二、线程

线程，有时被称为轻量级进程(Lightweight Process，LWP），是程序执行流的最小单元。一个标准的线程由线程ID，当前指令指针(PC），寄存器集合和堆栈组成。另外，线程是进程中的一个实体，是被系统独立调度和分派的基本单位，线程自己不拥有系统资源，只拥有一点儿在运行中必不可少的资源，但它可与同属一个进程的其它线程共享进程所拥有的全部资源。

线程是程序中一个单一的顺序控制流程。进程内有一个相对独立的、可调度的执行单元，是系统独立调度和分派CPU的基本单位指令运行时的程序的调度单位。在单个程序中同时运行多个线程完成不同的工作，称为多线程。

#### 特点

在多线程OS中，通常是在一个进程中包括多个线程，每个线程都是作为利用CPU的基本单位，是花费最小开销的实体。线程具有以下属性。 

##### 1）轻型实体 

线程中的实体基本上不拥有系统资源，只是有一点必不可少的、能保证独立运行的资源。 
线程的实体包括程序、数据和TCB。线程是动态概念，它的动态特性由线程控制块TCB（Thread Control Block）描述。TCB包括以下信息： 
（1）线程状态。 
（2）当线程不运行时，被保存的现场资源。 
（3）一组执行堆栈。 
（4）存放每个线程的局部变量主存区。 
（5）访问同一个进程中的主存和其它资源。 
用于指示被执行指令序列的程序计数器、保留局部变量、少数状态参数和返回地址等的一组寄存器和堆栈。 

##### 2）独立调度和分派的基本单位。 

在多线程OS中，线程是能独立运行的基本单位，因而也是独立调度和分派的基本单位。由于线程很“轻”，故线程的切换非常迅速且开销小（在同一进程中的）。 

##### 3）可并发执行。 

在一个进程中的多个线程之间，可以并发执行，甚至允许在一个进程中所有线程都能并发执行；同样，不同进程中的线程也能并发执行，充分利用和发挥了处理机与外围设备并行工作的能力。 

##### 4）共享进程资源。

在同一进程中的各个线程，都可以共享该进程所拥有的资源，这首先表现在：所有线程都具有相同的地址空间（进程的地址空间），这意味着，线程可以访问该地址空间的每一个虚地址；此外，还可以访问进程所拥有的已打开文件、定时器、信号量机构等。由于同一个进程内的线程共享内存和文件，所以线程之间互相通信不必调用内核。

### 三、协程

协程与子例程一样，协程（coroutine）也是一种程序组件。相对子例程而言，协程更为一般和灵活，但在实践中使用没有子例程那样广泛。协程源自 Simula 和 Modula-2 语言，但也有其他语言支持。 
协程不是进程或线程，其执行过程更类似于子例程，或者说不带返回值的函数调用。 
一个程序可以包含多个协程，可以对比与一个进程包含多个线程， 
因而下面我们来比较协程和线程。我们知道多个线程相对独立，有自己的上下文，切换受系统控制；而协程也相对独立，有自己的上下文，但是其切换由自己控制，由当前协程切换到其他协程由当前协程来控制。 
协程和线程区别：协程避免了无意义的调度，由此可以提高性能，但也因此，程序员必须自己承担调度的责任，同时，协程也失去了标准线程使用多CPU的能力。

### 四、进程和线程的关系和区别

![这里写图片描述](https://img-blog.csdn.net/20180301145908865?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3V5YW4wMzE5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

1、地址空间:进程内的一个执行单元;进程至少有一个线程;它们共享进程的地址空间;而进程有自己独立的地址空间;因此线程可以读写同样的数据结构和变量，便于线程之间的通信。相反，进程间通信（IPC）很困难且消耗更多资源。 
2、资源拥有:进程是资源分配和拥有的单位,同一个进程内的线程共享进程的资源 
3、进程是资源的分配和调度的一个独立单元，而线程是CPU调度的基本单元 
4、二者均可并发执行. 
5、进程的创建调用fork或者vfork，而线程的创建调用pthread_create，进程结束后它拥有的所有线程都将销毁，而线程的结束不会影响同个进程中的其他线程的结束 
6、线程有自己的私有属性TCB，线程id，寄存器、硬件上下文，而进程也有自己的私有属性进程控制块PCB，这些私有属性是不被共享的，用来标示一个进程或一个线程的标志

### 五、优缺点 

线程和进程在使用上各有优缺点：线程执行开销小，但不利于资源的管理和保护；而进程正相反。同时，线程适合于在SMP机器上运行，而进程则可以跨机器迁移。

最后送上，从网上找的材料，以图文方式将进程和线程做的很好的解释清晰易懂：

1、 
![这里写图片描述](https://img-blog.csdn.net/20180302170339122?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3V5YW4wMzE5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70) 
计算机的核心是CPU，它承担了所有的计算任务。它就像一座工厂，时刻在运行。 
2、 
![这里写图片描述](https://img-blog.csdn.net/20180302170405994?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3V5YW4wMzE5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70) 
假定工厂的电力有限，一次只能供给一个车间使用。也就是说，一个车间开工的时候，其他车间都必须停工。背后的含义就是，单个CPU一次只能运行一个任务。 
3、 
![这里写图片描述](https://img-blog.csdn.net/20180302170449391?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3V5YW4wMzE5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70) 
进程就好比工厂的车间，它代表CPU所能处理的单个任务。任一时刻，CPU总是运行一个进程，其他进程处于非运行状态 
4、 
![这里写图片描述](https://img-blog.csdn.net/20180302170520653?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3V5YW4wMzE5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70) 
一个车间里，可以有很多工人。他们协同完成一个任务。 
5、 
![这里写图片描述](https://img-blog.csdn.net/20180302170543109?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3V5YW4wMzE5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70) 
线程就好比车间里的工人。一个进程可以包括多个线程。 
6、 
![这里写图片描述](https://img-blog.csdn.net/20180302171635470?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3V5YW4wMzE5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70) 
车间的空间是工人们共享的，比如许多房间是每个工人都可以进出的。这象征一个进程的内存空间是共享的，每个线程都可以使用这些共享内存。 
7、 
![这里写图片描述](https://img-blog.csdn.net/2018030217170047?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3V5YW4wMzE5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70) 
可是，每间房间的大小不同，有些房间最多只能容纳一个人，比如厕所。里面有人的时候，其他人就不能进去了。这代表一个线程使用某些共享内存时，其他线程必须等它结束，才能使用这一块内存。 
8、 
![这里写图片描述](https://img-blog.csdn.net/20180302171735822?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3V5YW4wMzE5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70) 
一个防止他人进入的简单方法，就是门口加一把锁。先到的人锁上门，后到的人看到上锁，就在门口排队，等锁打开再进去。这就叫”互斥锁”（Mutual exclusion，缩写 Mutex），防止多个线程同时读写某一块内存区域。 
9、 
![这里写图片描述](https://img-blog.csdn.net/20180302171805311?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3V5YW4wMzE5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70) 
还有些房间，可以同时容纳n个人，比如厨房。也就是说，如果人数大于n，多出来的人只能在外面等着。这好比某些内存区域，只能供给固定数目的线程使用。 
10、 
![这里写图片描述](https://img-blog.csdn.net/20180302171848988?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3V5YW4wMzE5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70) 
这时的解决方法，就是在门口挂n把钥匙。进去的人就取一把钥匙，出来时再把钥匙挂回原处。后到的人发现钥匙架空了，就知道必须在门口排队等着了。这种做法叫做”信号量”（Semaphore），用来保证多个线程不会互相冲突。

不难看出，mutex是semaphore的一种特殊情况（n=1时）。也就是说，完全可以用后者替代前者。但是，因为mutex较为简单，且效率高，所以在必须保证资源独占的情况下，还是采用这种设计。 
11、 
![这里写图片描述](https://img-blog.csdn.net/20180302171917179?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3V5YW4wMzE5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

操作系统的设计，因此可以归结为三点：

（1）以多进程形式，允许多个任务同时运行；

（2）以多线程形式，允许单个任务分成不同的部分运行；

（3）提供协调机制，一方面防止进程之间和线程之间产生冲突，另一方面允许进程之间和线程之间共享资源。